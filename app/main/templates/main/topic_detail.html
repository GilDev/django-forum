{% extends 'base.html' %}

{% block extend_title %}Topic |{% endblock %}

{% block content %}
<div class="topic">
    <div class="inner-wrapper">
        <!-- Inner sidebar -->
        <div class="inner-sidebar">
            <!-- Inner sidebar header -->
            <a href="{% url 'topic_create' %}">
                <div class="inner-sidebar-header justify-content-center">
                    <button class="btn btn-primary has-icon btn-block" type="button">New topic</button>
                </div>
            </a>
            <!-- /Inner sidebar header -->

            <!-- Inner sidebar body -->
            <div class="inner-sidebar-body p-0">
                <div class="p-3 h-100" data-simplebar="init">
                    <nav class="nav nav-pills nav-gap-y-1 flex-column">
                        <a href="{% url 'topic_list' %}" class="nav-link nav-link-faded has-icon">All Threads</a>
                        <a href="{% url 'topic_list' %}?filter=solved" class="nav-link nav-link-faded has-icon">Solved</a>
                        <a href="{% url 'topic_list' %}?filter=unsolved" class="nav-link nav-link-faded has-icon">Unsolved</a>
                        <a href="{% url 'topic_list' %}?filter=no_replies" class="nav-link nav-link-faded has-icon">No replies yet</a>
                    </nav>
                </div>
            </div>
            <!-- /Inner sidebar body -->
        </div>
        <!-- /Inner sidebar -->

        <!-- Inner main -->
        <div class="inner-main">
            <!-- Inner main header -->
            <div class="inner-main-header">
                <span class="input-icon input-icon-sm ml-auto w-auto">
                    <form action="{% url 'topic_list' %}" method="get">
                        <div class="form-row align-items-center">
                            <div class="col-auto">
                                <input type="text" class="form-control bg-gray-200 border-gray-200 shadow-none"
                                    placeholder="Search forum" name="search" />
                            </div>
                            <div class="col-auto">
                                <input type="submit" class="btn btn-primary has-icon btn-block" value="Search" />
                            </div>
                        </div>
                    </form>
                </span>
            </div>
            <!-- /Inner main header -->

            <!-- Inner main body -->

            <!-- Forum Detail -->
            <div class="inner-main-body p-2 p-sm-3 forum-content">
                <a href="{% url 'topic_list' %}" class="btn btn-light btn-sm mb-3 has-icon">
                    <i class="fa fa-arrow-left mr-2"></i> Back
                </a>

                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}" role="alert">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}

                <div class="card">
                    <div class="card-body">
                        <div class="media forum-item">
                            <div class="card-link">
                                {% if topic.author == request.user %}
                                <a href="{% url 'profile' %}">
                                {% endif %}
                                    <img src="{{ topic.author.get_avatar_url }}" class="rounded-circle"
                                         width="50" alt="User" />
                                    <small class="d-block text-center text-muted">{{ topic.author.get_level_display }}</small>
                                {% if topic.author == request.user %}
                                </a>
                                {% endif %}
                            </div>
                            <div class="media-body ml-3">
                                <span class="text-secondary">{{ topic.author.get_fullname }}</span>
                                <small class="text-muted ml-2">{{ topic.date}} </small>
                                <h5 class="mt-1">{{ topic.title }}</h5>
                                <div class="mt-3 font-size-sm">
                                    <p>
                                        {{ topic.message }}
                                    </p>
                                </div>
                            </div>
                            <div class="text-muted small text-center">
                                <span><i class="far fa-comment ml-2"></i> {{ topic.comment_set.count }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />

                {% for comment in topic.comment_set.all %}
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="media forum-item">
                            <div class="card-link">
                                {% if comment.author == request.user %}
                                <a href="{% url 'profile' %}">
                                {% endif %}
                                    <img src="{{ comment.author.get_avatar_url }}" class="rounded-circle"
                                         width="50" alt="User" />
                                    <small class="d-block text-center text-muted">{{ comment.author.get_level_display }}</small>
                                {% if comment.author == request.user %}
                                </a>
                                {% endif %}
                            </div>
                            <div class="media-body ml-3">
                                <span class="text-secondary">{{ comment.author.get_fullname }}</span>
                                <small class="text-muted ml-2">{{ comment.date }}</small>
                                <div class="mt-3 font-size-sm">
                                    <p>
                                        {{ comment.message }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% if topic.comments %}<hr />{% endif %}

                <form method="post">
                    {% csrf_token %}
                    <div class="form-group mb-2">
                        <label for="reply" class="">Your message</label>
                        <textarea class="form-control" id="reply" name="reply" style="height: 145px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary mb-2">Send</button>
                </form>
            </div>
            <!-- /Forum Detail -->
        </div>
        <!-- /Inner main -->
    </div>
</div>
{% endblock %}